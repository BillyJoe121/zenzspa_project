# üöÄ ROADMAP DE DEPLOYMENT A PRODUCCI√ìN - STUDIOZENS

**Fecha:** Noviembre 2025
**Proyecto:** StudioZens - Sistema de Gesti√≥n de Spa con Marketplace y Bot
**Stack:** Django 5.2.3 + PostgreSQL + Redis + Celery + Gunicorn
**Plataforma:** Render.com (recomendado para este stack)

---

## üìä RESUMEN EJECUTIVO

### Arquitectura de Producci√≥n

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     FRONTEND (Cliente)                       ‚îÇ
‚îÇ                  https://estudiozens.com                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  RENDER WEB SERVICE                          ‚îÇ
‚îÇ          Backend Django + Gunicorn + WhiteNoise              ‚îÇ
‚îÇ                 (Auto-scaling 1-3 instancias)                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ                          ‚îÇ
            ‚ñº                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   RENDER POSTGRES     ‚îÇ    ‚îÇ    RENDER REDIS (TLS)      ‚îÇ
‚îÇ   (Managed Database)  ‚îÇ    ‚îÇ  Cache + Celery Broker     ‚îÇ
‚îÇ   - Auto backups      ‚îÇ    ‚îÇ  - Persistent              ‚îÇ
‚îÇ   - SSL/TLS           ‚îÇ    ‚îÇ  - High availability       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                        ‚îÇ
                                        ‚ñº
                          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                          ‚îÇ  RENDER BACKGROUND WORKER   ‚îÇ
                          ‚îÇ   Celery Worker + Beat      ‚îÇ
                          ‚îÇ  (Tareas as√≠ncronas)        ‚îÇ
                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   SERVICIOS EXTERNOS                         ‚îÇ
‚îÇ  - Twilio (SMS/WhatsApp) - Wompi (Pagos)                   ‚îÇ
‚îÇ  - Gemini (Bot AI)       - Sentry (Monitoreo)               ‚îÇ
‚îÇ  - SendGrid (Email)      - Cloudinary (Im√°genes - opcional) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Costos Estimados Mensuales

| Servicio | Plan Recomendado | Costo Mensual |
|----------|-----------------|---------------|
| **Render Web Service** | Starter ($25) ‚Üí Standard ($85) | $25-85 USD |
| **Render PostgreSQL** | Standard ($25) ‚Üí Pro ($65) | $25-65 USD |
| **Render Redis** | Standard ($10) | $10 USD |
| **Render Worker** | Starter ($25) | $25 USD |
| **Sentry** | Business ($26/mes) | $26 USD |
| **Twilio** | Pay as you go | $20-100 USD |
| **Wompi** | Sin costo mensual (comisiones por transacci√≥n) | $0 USD |
| **Gemini API** | Pay as you go | $10-50 USD |
| **SendGrid** | Essentials ($20/mes) | $20 USD |
| **TOTAL INICIAL** | | **$161-311 USD/mes** |

> **Nota:** Puedes empezar con el m√≠nimo ($161/mes) e ir escalando seg√∫n la demanda.

---

## üìã ORDEN RECOMENDADO DE DEPLOYMENT

### ‚úÖ FASE 0: PRE-REQUISITOS (1-2 d√≠as)

**Estado:** Completar ANTES de empezar deployment

#### 0.1. Tests y Validaci√≥n
- [ ] Tests al 90%+ de cobertura ‚úÖ (Planeas hacerlo)
- [ ] Tests E2E funcionando ‚úÖ (Planeas hacerlo)
- [ ] Colecci√≥n Postman completa y validada ‚úÖ (Planeas hacerlo)
- [ ] Validar que NO hay migraciones pendientes
  ```bash
  python manage.py makemigrations --check --dry-run
  ```

#### 0.2. Tareas Pendientes del An√°lisis
- [ ] Encriptar `vip_payment_token` (2-3 horas) - **RECOMENDADO**
- [ ] Implementar retry en notificaciones (3-4 horas) - **OPCIONAL**
- [ ] Separar JWT_SIGNING_KEY de SECRET_KEY (1 hora) - **RECOMENDADO**

#### 0.3. Dominio
- [ ] Comprar dominio (ej: `estudiozens.com`) - **GoDaddy, Namecheap, etc.**
- [ ] Tener acceso a configuraci√≥n DNS

---

## üóÇÔ∏è FASE 1: CONFIGURACI√ìN LOCAL Y PREPARACI√ìN (D√≠a 1-2)

### 1.1. Crear Archivo .env.production (Template)

**Archivo:** [`.env.production.template`](.env.production.template)

```bash
# ============================================================================
# CONFIGURACI√ìN DE PRODUCCI√ìN - STUDIOZENS
# ============================================================================
# INSTRUCCIONES:
# 1. Copia este archivo como .env.production
# 2. Reemplaza TODOS los valores de ejemplo con valores reales
# 3. NUNCA comitees .env.production al repositorio
# ============================================================================

# ---------------------------------------------------------------------------
# üîê SEGURIDAD (CR√çTICO - Generar valores √∫nicos)
# ---------------------------------------------------------------------------
SECRET_KEY=CAMBIAR_POR_SECRETO_UNICO_DE_50_CARACTERES
FERNET_KEY=CAMBIAR_POR_FERNET_KEY_GENERADO  # Ver secci√≥n de generaci√≥n
JWT_SIGNING_KEY=CAMBIAR_POR_JWT_KEY_UNICO  # Diferente a SECRET_KEY

# ---------------------------------------------------------------------------
# üåê CONFIGURACI√ìN DE DOMINIO Y HOSTS
# ---------------------------------------------------------------------------
DEBUG=0
ALLOWED_HOSTS=estudiozens.com,www.estudiozens.com,estudiozens.onrender.com
CORS_ALLOWED_ORIGINS=https://estudiozens.com,https://www.estudiozens.com
CSRF_TRUSTED_ORIGINS=https://estudiozens.com,https://www.estudiozens.com
SITE_URL=https://estudiozens.com

# ---------------------------------------------------------------------------
# üóÑÔ∏è BASE DE DATOS (Render PostgreSQL)
# ---------------------------------------------------------------------------
# Estos valores los obtienes de Render despu√©s de crear la base de datos
DB_NAME=studiozens_prod_db
DB_USER=studiozens_user
DB_PASSWORD=CAMBIAR_POR_PASSWORD_DE_RENDER
DB_HOST=dpg-XXXXXXXXXXXX-a.oregon-postgres.render.com
DB_PORT=5432
DB_SSLMODE=require
DB_CONN_MAX_AGE=600

# ---------------------------------------------------------------------------
# üî¥ REDIS (Render Redis con TLS)
# ---------------------------------------------------------------------------
# IMPORTANTE: DEBE usar rediss:// (con doble 's' para TLS)
REDIS_URL=rediss://:CAMBIAR_POR_PASSWORD@red-XXXXXXXXXXXX.oregon-redis.render.com:6379/0
CELERY_BROKER_URL=rediss://:CAMBIAR_POR_PASSWORD@red-XXXXXXXXXXXX.oregon-redis.render.com:6379/0
CELERY_RESULT_BACKEND=rediss://:CAMBIAR_POR_PASSWORD@red-XXXXXXXXXXXX.oregon-redis.render.com:6379/0

# ---------------------------------------------------------------------------
# üì± TWILIO (SMS y WhatsApp)
# ---------------------------------------------------------------------------
TWILIO_ACCOUNT_SID=ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
TWILIO_AUTH_TOKEN=tu_twilio_auth_token
TWILIO_VERIFY_SERVICE_SID=VAXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
TWILIO_PHONE_NUMBER=+57XXXXXXXXXX  # N√∫mero de Twilio
TWILIO_WHATSAPP_NUMBER=whatsapp:+14155238886  # N√∫mero de WhatsApp Business

# ---------------------------------------------------------------------------
# üí≥ WOMPI (Pagos)
# ---------------------------------------------------------------------------
WOMPI_PUBLIC_KEY=pub_prod_XXXXXXXXXXXXXXXXXXXX
WOMPI_PRIVATE_KEY=prv_prod_XXXXXXXXXXXXXXXXXXXX
WOMPI_INTEGRITY_SECRET=prod_integrity_XXXXXXXXXXXXXXX
WOMPI_EVENT_SECRET=prod_events_XXXXXXXXXXXXXXXXXX
WOMPI_PAYOUT_PRIVATE_KEY=prv_payout_prod_XXXXXXXXXXXX
WOMPI_PAYOUT_BASE_URL=https://production.wompi.co/v1
WOMPI_REDIRECT_URL=https://estudiozens.com/pago/completado
WOMPI_DEVELOPER_DESTINATION=joshexxxxxxxxx@estudiozens.com

# ---------------------------------------------------------------------------
# ü§ñ GEMINI API (Bot de IA)
# ---------------------------------------------------------------------------
GEMINI_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# ---------------------------------------------------------------------------
# üìß EMAIL (SendGrid recomendado)
# ---------------------------------------------------------------------------
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.sendgrid.net
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=apikey
EMAIL_HOST_PASSWORD=SG.XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
DEFAULT_FROM_EMAIL=noreply@estudiozens.com

# ---------------------------------------------------------------------------
# üîç SENTRY (Monitoreo de errores)
# ---------------------------------------------------------------------------
SENTRY_DSN=https://XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX@oXXXXXX.ingest.us.sentry.io/XXXXXXX
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1  # 10% de transacciones

# ---------------------------------------------------------------------------
# üîß CONFIGURACIONES ADICIONALES
# ---------------------------------------------------------------------------
# GeoIP2 (Opcional - para geolocalizaci√≥n real)
GEOIP_PATH=/app/geoip/GeoLite2-Country.mmdb

# Celery
CELERY_BEAT_SCHEDULE_FILENAME=/var/run/studiozens/celerybeat-schedule
CELERY_TASK_TIME_LIMIT=300
CELERY_TASK_SOFT_TIME_LIMIT=240
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000

# Timeouts y l√≠mites
TWILIO_TIMEOUT=10
TWILIO_CB_FAILURES=5
TWILIO_CB_TIMEOUT=60

# Recaptcha (si usas)
RECAPTCHA_SITE_KEY=6LeXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
RECAPTCHA_SECRET_KEY=6LeXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# ---------------------------------------------------------------------------
# üìä ANALYTICS Y LOGGING
# ---------------------------------------------------------------------------
LOG_LEVEL=INFO
LOG_SQL_QUERIES=0  # Deshabilitar en producci√≥n por performance
```

### 1.2. Generar Secretos de Producci√≥n

**Script de generaci√≥n:** [`scripts/generate_production_secrets.py`](scripts/generate_production_secrets.py)

```python
#!/usr/bin/env python3
"""
Script para generar secretos de producci√≥n para StudioZens.
Uso: python scripts/generate_production_secrets.py
"""
import secrets
from cryptography.fernet import Fernet

def generate_django_secret():
    """Genera SECRET_KEY de Django (50 caracteres)"""
    chars = 'abcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*(-_=+)'
    return ''.join(secrets.choice(chars) for _ in range(50))

def generate_jwt_key():
    """Genera JWT_SIGNING_KEY"""
    return secrets.token_urlsafe(64)

def generate_fernet_key():
    """Genera FERNET_KEY para encriptaci√≥n"""
    return Fernet.generate_key().decode()

if __name__ == "__main__":
    print("=" * 70)
    print("SECRETOS DE PRODUCCI√ìN - STUDIOZENS")
    print("=" * 70)
    print("\n‚ö†Ô∏è  IMPORTANTE: Guarda estos valores de forma segura")
    print("‚ö†Ô∏è  NUNCA los comitees al repositorio\n")

    print("# Copia estos valores a tu .env.production:\n")
    print(f"SECRET_KEY={generate_django_secret()}")
    print(f"JWT_SIGNING_KEY={generate_jwt_key()}")
    print(f"FERNET_KEY={generate_fernet_key()}")
    print("\n" + "=" * 70)
```

**Ejecutar:**
```bash
python scripts/generate_production_secrets.py
# Copiar output al .env.production
```

### 1.3. Actualizar .gitignore

Verificar que `.env.production` est√© ignorado:

```bash
# .gitignore
.env
.env.*
!.env.example
.env.production
.env.production.*
```

### 1.4. Crear requirements.txt Optimizado

Ya tienes un buen `requirements.txt`, pero verifica que incluya:

```txt
# Producci√≥n espec√≠fico
gunicorn==23.0.0          # ‚úÖ Ya incluido
whitenoise==6.7.0         # ‚úÖ Ya incluido
sentry-sdk==2.44.0        # ‚úÖ Ya incluido
psycopg2-binary==2.9.10   # ‚úÖ Ya incluido

# Opcional pero recomendado
django-storages==1.14.4   # Si usar√°s S3 para archivos est√°ticos
boto3==1.35.0             # Si usar√°s S3
geoip2==4.8.0             # Para GeoIP real
```

---

## üéØ FASE 2: CREAR SERVICIOS EN RENDER (D√≠a 2-3)

### **ORDEN CR√çTICO: Sigue este orden exacto**

```
1. PostgreSQL (Base de datos)
   ‚Üì
2. Redis (Cache + Celery broker)
   ‚Üì
3. Web Service (Backend Django)
   ‚Üì
4. Background Worker (Celery)
```

### 2.1. CREAR POSTGRESQL DATABASE (PRIMERO)

**¬øPor qu√© primero?** El backend necesita la DB para las migraciones iniciales.

#### Pasos en Render.com:

1. **Dashboard ‚Üí New ‚Üí PostgreSQL**
2. **Configuraci√≥n:**
   - **Name:** `studiozens-db`
   - **Database:** `studiozens_prod_db`
   - **User:** `studiozens_user` (auto-generado)
   - **Region:** `Oregon (US West)` (recomendado para latencia)
   - **Plan:** **Standard ($25/mes)** para empezar
     - 1 GB RAM
     - 10 GB Storage
     - Daily backups
     - Point-in-time recovery (7 d√≠as)

3. **Crear y esperar** (~5 minutos)

4. **Copiar credenciales:**
   ```
   Internal Database URL:  postgres://studiozens_user:xxxxx@dpg-xxxxx/studiozens_prod_db
   External Database URL:  postgres://studiozens_user:xxxxx@dpg-xxxxx.oregon-postgres.render.com/studiozens_prod_db

   Host: dpg-xxxxx-a.oregon-postgres.render.com
   Port: 5432
   Database: studiozens_prod_db
   Username: studiozens_user
   Password: [COPIAR - 32 caracteres]
   ```

5. **Actualizar .env.production:**
   ```bash
   DB_HOST=dpg-xxxxx-a.oregon-postgres.render.com
   DB_NAME=studiozens_prod_db
   DB_USER=studiozens_user
   DB_PASSWORD=[PASSWORD_DE_RENDER]
   DB_PORT=5432
   DB_SSLMODE=require
   ```

### 2.2. CREAR REDIS INSTANCE (SEGUNDO)

**¬øPor qu√© segundo?** Celery y cache lo necesitan antes de arrancar el worker.

#### Pasos:

1. **Dashboard ‚Üí New ‚Üí Redis**
2. **Configuraci√≥n:**
   - **Name:** `studiozens-redis`
   - **Region:** `Oregon (US West)` (mismo que PostgreSQL)
   - **Plan:** **Standard ($10/mes)**
     - 256 MB RAM
     - Persistent
     - TLS enabled

3. **Crear y esperar** (~3 minutos)

4. **Copiar URL de Redis:**
   ```
   Internal Redis URL:  rediss://red-xxxxx:xxxxx@red-xxxxx:6379
   External Redis URL:  rediss://red-xxxxx:xxxxx@red-xxxxx.oregon-redis.render.com:6379
   ```

5. **Actualizar .env.production:**
   ```bash
   REDIS_URL=rediss://red-xxxxx:[PASSWORD]@red-xxxxx.oregon-redis.render.com:6379/0
   CELERY_BROKER_URL=rediss://red-xxxxx:[PASSWORD]@red-xxxxx.oregon-redis.render.com:6379/0
   CELERY_RESULT_BACKEND=rediss://red-xxxxx:[PASSWORD]@red-xxxxx.oregon-redis.render.com:6379/0
   ```

   **‚ö†Ô∏è CR√çTICO:** Aseg√∫rate de usar `rediss://` (doble 's') para TLS.

### 2.3. CREAR WEB SERVICE - BACKEND DJANGO (TERCERO)

**¬øPor qu√© tercero?** Necesita DB y Redis ya creados para conectarse.

#### Pasos:

1. **Dashboard ‚Üí New ‚Üí Web Service**
2. **Conectar repositorio:**
   - Conectar GitHub/GitLab
   - Seleccionar repositorio `studiozens`
   - Branch: `main` o `production`

3. **Configuraci√≥n:**
   - **Name:** `studiozens-backend`
   - **Region:** `Oregon (US West)`
   - **Branch:** `main`
   - **Root Directory:** ` ` (vac√≠o, proyecto en ra√≠z)
   - **Environment:** `Python 3`
   - **Build Command:**
     ```bash
     pip install --upgrade pip && pip install -r requirements.txt
     ```
   - **Start Command:**
     ```bash
     gunicorn studiozens.wsgi:application --bind 0.0.0.0:$PORT --workers 3 --timeout 120 --access-logfile - --error-logfile -
     ```

4. **Plan:** **Starter ($25/mes)** para empezar
   - 512 MB RAM
   - 0.5 CPU
   - Auto-scaling hasta 1 instancia

5. **Variables de entorno:**

   **‚ö†Ô∏è IMPORTANTE:** Copia TODO el contenido de tu `.env.production` aqu√≠.

   En la secci√≥n "Environment Variables", agrega **UNA POR UNA**:
   - `SECRET_KEY` = [tu secreto generado]
   - `FERNET_KEY` = [tu fernet key]
   - `JWT_SIGNING_KEY` = [tu jwt key]
   - `DEBUG` = `0`
   - `ALLOWED_HOSTS` = `estudiozens.com,www.estudiozens.com,estudiozens-backend.onrender.com`
   - `CORS_ALLOWED_ORIGINS` = `https://estudiozens.com,https://www.estudiozens.com`
   - ... (todas las dem√°s del .env.production)

   **Variables especiales de Render:**
   - `PYTHON_VERSION` = `3.11.9`
   - `PORT` = (Render lo configura autom√°ticamente)

6. **Agregar archivo `render.yaml` (opcional pero recomendado):**

   **Archivo:** [`render.yaml`](render.yaml)
   ```yaml
   services:
     - type: web
       name: studiozens-backend
       env: python
       region: oregon
       plan: starter
       branch: main
       buildCommand: pip install --upgrade pip && pip install -r requirements.txt
       startCommand: gunicorn studiozens.wsgi:application --bind 0.0.0.0:$PORT --workers 3 --timeout 120 --access-logfile - --error-logfile -
       envVars:
         - key: PYTHON_VERSION
           value: 3.11.9
         - key: DEBUG
           value: 0
         # Resto de variables desde el dashboard

     - type: worker
       name: studiozens-celery-worker
       env: python
       region: oregon
       plan: starter
       branch: main
       buildCommand: pip install --upgrade pip && pip install -r requirements.txt
       startCommand: celery -A studiozens worker -l info --concurrency=2

     - type: worker
       name: studiozens-celery-beat
       env: python
       region: oregon
       plan: starter
       branch: main
       buildCommand: pip install --upgrade pip && pip install -r requirements.txt
       startCommand: celery -A studiozens beat -l info
   ```

7. **Crear y esperar el deploy** (~10-15 minutos en el primer deploy)

8. **Verificar logs:**
   - Deber√≠a ver: "Starting gunicorn..."
   - **Migraciones:** Se ejecutan autom√°ticamente en el build si agregas al Build Command:
     ```bash
     pip install --upgrade pip && pip install -r requirements.txt && python manage.py migrate --noinput && python manage.py collectstatic --noinput
     ```

9. **Copiar URL:**
   ```
   URL: https://estudiozens-backend.onrender.com
   ```

### 2.4. CREAR BACKGROUND WORKER - CELERY (CUARTO)

**¬øPor qu√© cuarto?** Necesita DB, Redis y el c√≥digo del backend ya deployado.

#### Pasos:

1. **Dashboard ‚Üí New ‚Üí Background Worker**
2. **Conectar mismo repositorio:** `studiozens`
3. **Configuraci√≥n:**
   - **Name:** `studiozens-celery-worker`
   - **Region:** `Oregon (US West)`
   - **Branch:** `main`
   - **Build Command:**
     ```bash
     pip install --upgrade pip && pip install -r requirements.txt
     ```
   - **Start Command:**
     ```bash
     celery -A studiozens worker -l info --concurrency=2 -Q celery,payments,appointments,notifications,bot
     ```

4. **Plan:** **Starter ($25/mes)**
   - 512 MB RAM
   - Procesa tareas as√≠ncronas

5. **Variables de entorno:**

   **‚ö†Ô∏è IMPORTANTE:** Copiar **EXACTAMENTE** las mismas variables que el Web Service.

   Render permite **copiar** variables de otro servicio:
   - En "Environment Variables" ‚Üí "Import from service"
   - Seleccionar `studiozens-backend`

6. **Crear segundo worker para Celery Beat:**

   Repetir proceso pero:
   - **Name:** `studiozens-celery-beat`
   - **Start Command:**
     ```bash
     celery -A studiozens beat -l info --scheduler django_celery_beat.schedulers:DatabaseScheduler
     ```
   - **Plan:** **Starter ($25/mes)**

   > **Nota:** Celery Beat ejecuta tareas programadas (recordatorios, limpieza, etc.)

---

## ‚öôÔ∏è FASE 3: CONFIGURACI√ìN DE SERVICIOS EXTERNOS (D√≠a 3-4)

### 3.1. SENTRY (Monitoreo de Errores) - PRIMERO

**¬øPor qu√© primero?** Querr√°s monitorear errores desde el primer momento.

#### Pasos:

1. **Crear cuenta en [sentry.io](https://sentry.io)**
2. **Crear nuevo proyecto:**
   - Framework: **Django**
   - Project name: `studiozens-production`
   - Plan: **Business ($26/mes)** o **Team ($0 - limitado)**

3. **Copiar DSN:**
   ```
   DSN: https://xxxxx@oxxxxx.ingest.us.sentry.io/xxxxx
   ```

4. **Actualizar .env.production:**
   ```bash
   SENTRY_DSN=https://xxxxx@oxxxxx.ingest.us.sentry.io/xxxxx
   SENTRY_ENVIRONMENT=production
   SENTRY_TRACES_SAMPLE_RATE=0.1
   ```

5. **Verificar integraci√≥n:**
   - Deploy del backend con nueva variable
   - Sentry ‚Üí Issues: deber√≠as ver eventos del primer deploy

### 3.2. TWILIO (SMS y WhatsApp)

#### Pasos:

1. **Cuenta de Twilio:**
   - Ir a [twilio.com/console](https://www.twilio.com/console)
   - Ya deber√≠as tener cuenta configurada

2. **Producci√≥n - Actualizar a cuenta paga:**
   - Twilio Console ‚Üí Billing
   - Agregar m√©todo de pago
   - Recargar cr√©dito inicial: $20 USD recomendado

3. **Copiar credenciales de producci√≥n:**
   ```
   Account SID: ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
   Auth Token: [32 caracteres]
   ```

4. **Crear Verify Service (para OTP):**
   - Twilio Console ‚Üí Verify ‚Üí Services
   - Create new Service: "StudioZens Production"
   - Copiar Service SID: `VAXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX`

5. **Configurar WhatsApp (si usas):**
   - Twilio Console ‚Üí Messaging ‚Üí Try it out ‚Üí Send a WhatsApp message
   - N√∫mero de WhatsApp: `whatsapp:+14155238886` (Twilio Sandbox)
   - **Para producci√≥n:** Solicitar n√∫mero WhatsApp Business aprobado

6. **Actualizar .env.production:**
   ```bash
   TWILIO_ACCOUNT_SID=ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
   TWILIO_AUTH_TOKEN=[AUTH_TOKEN]
   TWILIO_VERIFY_SERVICE_SID=VAXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
   TWILIO_PHONE_NUMBER=+57XXXXXXXXXX
   TWILIO_WHATSAPP_NUMBER=whatsapp:+14155238886
   ```

### 3.3. WOMPI (Pasarela de Pagos)

#### Pasos:

1. **Activar cuenta de producci√≥n:**
   - Wompi Dashboard ‚Üí Settings ‚Üí Producci√≥n
   - Completar KYC (Know Your Customer): documento, cuenta bancaria, etc.
   - Esperar aprobaci√≥n (~2-5 d√≠as h√°biles)

2. **Copiar credenciales de producci√≥n:**
   ```
   Public Key: pub_prod_XXXXXXXXXXXXXXXXXXXX
   Private Key: prv_prod_XXXXXXXXXXXXXXXXXXXX
   Integrity Secret: prod_integrity_XXXXXXXXXXXXXXX
   Events Secret: prod_events_XXXXXXXXXXXXXXXXXX
   ```

3. **Configurar Webhooks:**
   - Wompi Dashboard ‚Üí Webhooks
   - URL: `https://estudiozens-backend.onrender.com/api/finances/webhooks/wompi/`
   - Events: `transaction.updated`, `payment_intent.updated`
   - Copiar Event Secret

4. **Configurar dispersiones (payouts):**
   - Wompi Dashboard ‚Üí Payouts
   - Habilitar dispersiones autom√°ticas
   - Configurar cuenta de destino del desarrollador
   - Copiar Payout Private Key

5. **Actualizar .env.production:**
   ```bash
   WOMPI_PUBLIC_KEY=pub_prod_XXXXXXXXXXXXXXXXXXXX
   WOMPI_PRIVATE_KEY=prv_prod_XXXXXXXXXXXXXXXXXXXX
   WOMPI_INTEGRITY_SECRET=prod_integrity_XXXXXXXXXXXXXXX
   WOMPI_EVENT_SECRET=prod_events_XXXXXXXXXXXXXXXXXX
   WOMPI_PAYOUT_PRIVATE_KEY=prv_payout_prod_XXXXXXXXXXXX
   WOMPI_PAYOUT_BASE_URL=https://production.wompi.co/v1
   WOMPI_REDIRECT_URL=https://estudiozens.com/pago/completado
   WOMPI_DEVELOPER_DESTINATION=tu_email@dominio.com
   ```

### 3.4. GEMINI API (Bot de IA)

#### Pasos:

1. **Google AI Studio:**
   - Ir a [aistudio.google.com/app/apikey](https://aistudio.google.com/app/apikey)
   - Create API Key ‚Üí Create API key in new project

2. **Copiar API Key:**
   ```
   API Key: AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
   ```

3. **Configurar l√≠mites (recomendado):**
   - Google Cloud Console ‚Üí APIs & Services ‚Üí Gemini API
   - Quotas: 60 requests/minute (suficiente para empezar)

4. **Actualizar .env.production:**
   ```bash
   GEMINI_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
   ```

### 3.5. SENDGRID (Email)

#### Pasos:

1. **Crear cuenta en [sendgrid.com](https://sendgrid.com)**
2. **Plan:** Essentials ($20/mes) - 50K emails/mes
3. **Crear API Key:**
   - Settings ‚Üí API Keys ‚Üí Create API Key
   - Permissions: Full Access
   - Copiar: `SG.XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX`

4. **Verificar dominio:**
   - Settings ‚Üí Sender Authentication ‚Üí Verify a domain
   - Dominio: `estudiozens.com`
   - Agregar registros DNS:
     ```
     CNAME: em1234.estudiozens.com ‚Üí u1234567.wl123.sendgrid.net
     CNAME: s1._domainkey.estudiozens.com ‚Üí s1.domainkey.u1234567.wl123.sendgrid.net
     CNAME: s2._domainkey.estudiozens.com ‚Üí s2.domainkey.u1234567.wl123.sendgrid.net
     ```

5. **Actualizar .env.production:**
   ```bash
   EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
   EMAIL_HOST=smtp.sendgrid.net
   EMAIL_PORT=587
   EMAIL_USE_TLS=True
   EMAIL_HOST_USER=apikey
   EMAIL_HOST_PASSWORD=SG.XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
   DEFAULT_FROM_EMAIL=noreply@estudiozens.com
   ```

---

## üåê FASE 4: CONFIGURACI√ìN DE DOMINIO Y DNS (D√≠a 4-5)

### 4.1. Configurar DNS en tu Registrar

**Ejemplo con GoDaddy/Namecheap:**

#### Registros DNS a agregar:

```
Tipo    Nombre              Valor                                           TTL
----    ------              -----                                           ---
A       @                   [IP de Render - solicitar en support]          600
A       www                 [IP de Render - solicitar en support]          600
CNAME   www                 estudiozens-backend.onrender.com                600

# Para SendGrid (email)
CNAME   em1234              u1234567.wl123.sendgrid.net                     3600
CNAME   s1._domainkey       s1.domainkey.u1234567.wl123.sendgrid.net        3600
CNAME   s2._domainkey       s2.domainkey.u1234567.wl123.sendgrid.net        3600

# Para SSL (opcional - Render lo maneja autom√°ticamente)
# No se requieren registros adicionales si usas Render SSL
```

**Alternativa m√°s simple (recomendado para empezar):**

Si usas **solo el subdominio de Render** al inicio:

```
CNAME   api                 estudiozens-backend.onrender.com                600
```

Acceso: `https://api.estudiozens.com`

### 4.2. Configurar Custom Domain en Render

#### Pasos:

1. **Render Dashboard ‚Üí studiozens-backend ‚Üí Settings ‚Üí Custom Domains**
2. **Add Custom Domain:**
   - Domain: `estudiozens.com`
   - Add `www.estudiozens.com` tambi√©n

3. **Esperar verificaci√≥n DNS** (~10-30 minutos)

4. **Render generar√° certificado SSL autom√°ticamente** (Let's Encrypt)
   - Esperar status: "Verified" y "SSL Active"

5. **Actualizar variables de entorno:**
   ```bash
   ALLOWED_HOSTS=estudiozens.com,www.estudiozens.com,estudiozens-backend.onrender.com
   CORS_ALLOWED_ORIGINS=https://estudiozens.com,https://www.estudiozens.com
   SITE_URL=https://estudiozens.com
   ```

6. **Re-deploy** para aplicar cambios

### 4.3. Configurar Redirecci√≥n HTTP ‚Üí HTTPS

Render lo hace autom√°ticamente. Verificar en settings:
- ‚úÖ Force HTTPS: Enabled

---

## üöÄ FASE 5: DEPLOYMENT Y VALIDACI√ìN (D√≠a 5-6)

### 5.1. Pre-Deployment Checklist

```bash
# Local - Verificar que todo funciona
‚ñ° python manage.py check --deploy
‚ñ° python manage.py test
‚ñ° python manage.py makemigrations --check --dry-run
‚ñ° Postman collection completa ejecutada
‚ñ° E2E tests passing
```

### 5.2. Deploy Inicial

#### En Render:

1. **Web Service (Backend):**
   - Manual Deploy ‚Üí Deploy latest commit
   - Ver logs en tiempo real
   - Esperar "Gunicorn starting..."

2. **Verificar migraciones:**
   ```bash
   # En Render Shell (Settings ‚Üí Shell)
   python manage.py showmigrations
   # Todas las migraciones deben estar aplicadas [X]
   ```

3. **Crear superusuario:**
   ```bash
   # En Render Shell
   python manage.py createsuperuser
   ```

4. **Verificar Celery Worker:**
   - Ver logs: deber√≠a mostrar "celery@xxxxx ready"
   - Verificar conexi√≥n a Redis

5. **Verificar Celery Beat:**
   - Ver logs: deber√≠a mostrar "Scheduler: Sending due task..."

### 5.3. Health Checks

#### Endpoints a verificar:

```bash
# Health check
curl https://estudiozens-backend.onrender.com/api/core/health/
# Esperado: {"status":"ok","timestamp":"...","timezone":"America/Bogota"}

# Admin
https://estudiozens-backend.onrender.com/admin/
# Esperado: P√°gina de login de Django admin

# API root
curl https://estudiozens-backend.onrender.com/api/
# Esperado: Lista de endpoints disponibles
```

### 5.4. Pruebas Funcionales

#### 1. Registro de Usuario (OTP)
```bash
curl -X POST https://estudiozens-backend.onrender.com/api/users/register/ \
  -H "Content-Type: application/json" \
  -d '{
    "phone_number": "+573001234567",
    "password": "TestPass123!"
  }'
# Verificar: OTP enviado por Twilio
```

#### 2. Bot de WhatsApp
- Enviar mensaje al n√∫mero de Twilio WhatsApp
- Verificar respuesta del bot

#### 3. Pago con Wompi
- Crear orden de prueba
- Verificar webhook recibido
- Verificar actualizaci√≥n de estado

#### 4. Celery - Tarea programada
```bash
# En Render Shell del Worker
python manage.py shell
>>> from spa.tasks import send_appointment_reminder
>>> send_appointment_reminder.delay()
# Verificar logs
```

### 5.5. Monitoreo Post-Deploy

#### En Sentry:
- Ver que eventos est√°n llegando
- Verificar que no hay errores cr√≠ticos

#### En Render Logs:
- Web Service: Sin errores 500
- Celery Worker: Tareas proces√°ndose
- Celery Beat: Schedule ejecut√°ndose

#### M√©tricas a monitorear (primeros d√≠as):
- Latencia de requests (< 500ms promedio)
- Tasa de error (< 1%)
- Uso de RAM (< 80% del l√≠mite)
- Uso de CPU (< 70% del l√≠mite)
- Conexiones a DB (< 50% del pool)

---

## üîß FASE 6: OPTIMIZACI√ìN POST-DEPLOY (Semana 2)

### 6.1. Performance

```python
# settings/production.py (crear si no existe)
from .base import *

# Cach√© m√°s agresivo
CACHES = {
    'default': {
        'BACKEND': 'django_redis.cache.RedisCache',
        'LOCATION': os.getenv('REDIS_URL'),
        'OPTIONS': {
            'CLIENT_CLASS': 'django_redis.client.DefaultClient',
            'SOCKET_CONNECT_TIMEOUT': 5,
            'SOCKET_TIMEOUT': 5,
            'CONNECTION_POOL_KWARGS': {'max_connections': 50},
            'COMPRESSOR': 'django_redis.compressors.zlib.ZlibCompressor',
        }
    }
}

# Sessions en Redis
SESSION_ENGINE = 'django.contrib.sessions.backends.cache'
SESSION_CACHE_ALIAS = 'default'
```

### 6.2. Configurar Backups Autom√°ticos

#### PostgreSQL en Render:
- Ya incluye backups diarios (plan Standard)
- Configurar retenci√≥n: 7 d√≠as (incluido)
- Para mayor retenci√≥n: upgrade a plan Pro (30 d√≠as)

#### Backup manual adicional (recomendado):
```bash
# Script de backup semanal
# Guardar en Google Drive / Dropbox

#!/bin/bash
# backup_db.sh
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="studiozens_backup_$DATE.sql"

pg_dump $DATABASE_URL > $BACKUP_FILE
gzip $BACKUP_FILE

# Subir a Google Drive (con rclone o similar)
rclone copy $BACKUP_FILE.gz gdrive:backups/studiozens/
```

### 6.3. Configurar Alertas

#### En Sentry:
- Alerts ‚Üí New Alert Rule
- Condici√≥n: Error rate > 1% en 5 minutos
- Acci√≥n: Email a tu correo

#### En Render:
- Settings ‚Üí Notifications
- Configurar email para:
  - Deploy failures
  - Service crashes
  - Health check failures

### 6.4. Documentaci√≥n para el Equipo

Crear: [`docs/DEPLOYMENT_RUNBOOK.md`](docs/DEPLOYMENT_RUNBOOK.md)

```markdown
# Runbook de Producci√≥n - StudioZens

## Accesos
- Render: https://dashboard.render.com
- Sentry: https://sentry.io/organizations/studiozens/
- Twilio: https://console.twilio.com
- Wompi: https://comercios.wompi.co

## Comandos Comunes

### Re-deploy manual
Render Dashboard ‚Üí Manual Deploy ‚Üí Deploy latest commit

### Ver logs en tiempo real
Render Dashboard ‚Üí Logs (auto-refresh)

### Ejecutar migraciones
Render Shell ‚Üí `python manage.py migrate`

### Limpiar cach√© de Redis
Render Shell ‚Üí `python manage.py shell`
```python
from django.core.cache import cache
cache.clear()
```

## Troubleshooting

### Error 500 en producci√≥n
1. Revisar Sentry para stack trace
2. Revisar Render logs
3. Verificar variables de entorno

### Celery no procesa tareas
1. Verificar que worker est√© running
2. Revisar conexi√≥n a Redis
3. Ver logs de celery worker

### DB connection timeout
1. Verificar que DB est√© up en Render
2. Revisar pool de conexiones (CONN_MAX_AGE)
3. Verificar queries lentas en PostgreSQL Insights
```

---

## üìä CHECKLIST FINAL ANTES DE PRODUCCI√ìN

```
### Seguridad
‚ñ° SECRET_KEY √∫nico y seguro (50+ caracteres)
‚ñ° DEBUG=0 en producci√≥n
‚ñ° ALLOWED_HOSTS configurado correctamente
‚ñ° CSRF_TRUSTED_ORIGINS configurado
‚ñ° CORS_ALLOWED_ORIGINS configurado
‚ñ° HSTS habilitado (en security.py)
‚ñ° CSP headers configurados
‚ñ° SSL/TLS activo (certificado verificado)
‚ñ° Credenciales de servicios externos en producci√≥n (no sandbox)

### Base de Datos
‚ñ° PostgreSQL en Render creado
‚ñ° Migraciones aplicadas
‚ñ° Superusuario creado
‚ñ° Backups autom√°ticos configurados
‚ñ° √çndices optimizados
‚ñ° Connection pooling configurado

### Cache y Celery
‚ñ° Redis en Render creado con TLS
‚ñ° CELERY_BROKER_URL usa rediss://
‚ñ° Celery Worker running
‚ñ° Celery Beat running
‚ñ° Tareas programadas verificadas

### Servicios Externos
‚ñ° Twilio: cuenta de pago activa, cr√©dito suficiente
‚ñ° Wompi: cuenta de producci√≥n aprobada, webhooks configurados
‚ñ° Gemini: API key v√°lido, l√≠mites configurados
‚ñ° SendGrid: dominio verificado, API key v√°lido
‚ñ° Sentry: DSN configurado, alertas activas

### Dominio y DNS
‚ñ° Dominio comprado
‚ñ° DNS configurado (A/CNAME records)
‚ñ° Custom domain en Render verificado
‚ñ° SSL activo en dominio custom
‚ñ° Redirecci√≥n HTTP ‚Üí HTTPS funcionando

### Testing
‚ñ° Tests unitarios al 90%+
‚ñ° Tests E2E pasando
‚ñ° Colecci√≥n Postman validada en producci√≥n
‚ñ° Load testing (opcional pero recomendado)

### Monitoreo
‚ñ° Sentry configurado y recibiendo eventos
‚ñ° Logs de Render monitoreados
‚ñ° Alertas configuradas
‚ñ° M√©tricas de performance monitoreadas

### Documentaci√≥n
‚ñ° .env.production.template creado
‚ñ° Runbook de producci√≥n documentado
‚ñ° Accesos documentados (para el equipo)
‚ñ° Procedimientos de emergencia documentados

### Compliance (si aplica)
‚ñ° GDPR: endpoint de eliminaci√≥n de datos
‚ñ° GDPR: endpoint de exportaci√≥n de datos
‚ñ° HIPAA: encriptaci√≥n de datos sensibles
‚ñ° Pol√≠tica de privacidad actualizada
‚ñ° T√©rminos y condiciones actualizados
```

---

## üÜò TROUBLESHOOTING COM√öN

### Problema: "No module named 'studiozens'"

**Causa:** Build command no instal√≥ correctamente

**Soluci√≥n:**
```bash
# Build Command en Render
pip install --upgrade pip setuptools wheel && pip install -r requirements.txt
```

### Problema: "could not connect to server"

**Causa:** DB_HOST incorrecto o DB no creado

**Soluci√≥n:**
1. Verificar que PostgreSQL est√© "Available" en Render
2. Copiar "External Database URL" exacto
3. Verificar variables DB_HOST, DB_PORT, DB_NAME, DB_USER, DB_PASSWORD

### Problema: Celery "Cannot connect to redis"

**Causa:** URL de Redis sin TLS o incorrecta

**Soluci√≥n:**
```bash
# Debe ser rediss:// (doble 's')
CELERY_BROKER_URL=rediss://...
# NO redis:// (sin TLS)
```

### Problema: "403 Forbidden" en POST requests

**Causa:** CSRF_TRUSTED_ORIGINS no incluye el dominio

**Soluci√≥n:**
```bash
CSRF_TRUSTED_ORIGINS=https://estudiozens.com,https://www.estudiozens.com
```

### Problema: Wompi webhook no llega

**Causa:** URL de webhook incorrecta o evento no suscrito

**Soluci√≥n:**
1. Wompi Dashboard ‚Üí Webhooks
2. Verificar URL: `https://estudiozens-backend.onrender.com/api/finances/webhooks/wompi/`
3. Verificar eventos suscritos: `transaction.updated`

---

## üí∞ OPTIMIZACI√ìN DE COSTOS

### Mes 1-3 (MVP - $161/mes):
```
- Render Web Service: Starter ($25)
- Render PostgreSQL: Standard ($25)
- Render Redis: Standard ($10)
- Render Worker x2: Starter ($50)
- Sentry: Team (Gratis hasta 5K events/mes)
- SendGrid: Essentials ($20)
- Twilio: Pay-as-you-go (~$20)
- Gemini: Pay-as-you-go (~$10)
```

### Mes 4-6 (Crecimiento - $250/mes):
```
- Render Web Service: Standard ($85) - m√°s RAM y CPU
- Render PostgreSQL: Standard ($25)
- Render Redis: Standard ($10)
- Render Worker x2: Starter ($50)
- Sentry: Business ($26)
- SendGrid: Essentials ($20)
- Twilio: ~$30
- Gemini: ~$15
```

### Mes 7+ (Escala - $400+/mes):
```
- Render Web Service: Pro ($150) - auto-scaling
- Render PostgreSQL: Pro ($65) - m√°s storage
- Render Redis: Standard ($10)
- Render Worker x3: Starter ($75) - m√°s workers
- Sentry: Business ($26)
- SendGrid: Pro ($90) - m√°s emails
- Twilio: ~$50
- Gemini: ~$25
```

---

## üéì RECURSOS Y DOCUMENTACI√ìN

### Render.com
- [Deploy Django](https://render.com/docs/deploy-django)
- [Managed PostgreSQL](https://render.com/docs/databases)
- [Background Workers](https://render.com/docs/background-workers)

### Django
- [Deployment Checklist](https://docs.djangoproject.com/en/5.0/howto/deployment/checklist/)
- [Security in Django](https://docs.djangoproject.com/en/5.0/topics/security/)

### Celery
- [Celery on Render](https://docs.celeryq.dev/en/stable/userguide/deploying.html)

### Sentry
- [Django Integration](https://docs.sentry.io/platforms/python/guides/django/)

---

## ‚úÖ RESUMEN EJECUTIVO

### Tiempo Estimado Total: 5-7 d√≠as

| Fase | Tiempo | Costo |
|------|--------|-------|
| Pre-requisitos | 1-2 d√≠as | $0 |
| Configuraci√≥n local | 0.5 d√≠as | $0 |
| Crear servicios Render | 1 d√≠a | $85/mes |
| Configurar servicios externos | 1-2 d√≠as | $76/mes |
| Dominio y DNS | 0.5-1 d√≠a | $15/a√±o |
| Deploy y validaci√≥n | 1 d√≠a | - |
| Optimizaci√≥n post-deploy | Ongoing | - |

**Costo inicial total:** ~$161/mes + $15/a√±o dominio

### Orden de Ejecuci√≥n Recomendado:

```
D√≠a 1:
‚ñ° Completar tests (90%+)
‚ñ° Generar secretos de producci√≥n
‚ñ° Crear .env.production

D√≠a 2:
‚ñ° Crear PostgreSQL en Render
‚ñ° Crear Redis en Render
‚ñ° Configurar Sentry

D√≠a 3:
‚ñ° Crear Web Service en Render
‚ñ° Crear Celery Workers
‚ñ° Verificar deployment inicial

D√≠a 4:
‚ñ° Configurar Twilio (producci√≥n)
‚ñ° Configurar Wompi (producci√≥n)
‚ñ° Configurar Gemini
‚ñ° Configurar SendGrid

D√≠a 5:
‚ñ° Configurar dominio y DNS
‚ñ° Configurar SSL
‚ñ° Testing completo en producci√≥n

D√≠a 6:
‚ñ° Monitoreo y ajustes
‚ñ° Documentaci√≥n final

D√≠a 7:
‚ñ° Go live! üöÄ
```

---

**¬øListo para empezar?** Comienza con la Fase 0 y sigue el orden recomendado paso a paso.

**¬øDudas?** Cada fase tiene instrucciones detalladas. No te saltes pasos.

**¬°√âxito con el deployment! üöÄ**
